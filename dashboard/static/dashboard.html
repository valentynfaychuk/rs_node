<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amadeus Blockchain Node Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/clsx@2.0.0/dist/clsx.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: system-ui, sans-serif; }
        .bg-background { background-color: hsl(0 0% 100%); }
        .bg-card { background-color: hsl(0 0% 100%); }
        .bg-muted { background-color: hsl(210 40% 96%); }
        .bg-primary { background-color: hsl(221.2 83.2% 53.3%); }
        .bg-destructive { background-color: hsl(0 84.2% 60.2%); }
        .text-foreground { color: hsl(222.2 84% 4.9%); }
        .text-muted-foreground { color: hsl(215.4 16.3% 46.9%); }
        .text-card-foreground { color: hsl(222.2 84% 4.9%); }
        .text-primary { color: hsl(221.2 83.2% 53.3%); }
        .text-destructive { color: hsl(0 84.2% 60.2%); }
        .border-border { border-color: hsl(214.3 31.8% 91.4%); }
        .border-primary { border-color: hsl(221.2 83.2% 53.3%); }
        
        @media (prefers-color-scheme: dark) {
            .bg-background { background-color: hsl(222.2 84% 4.9%); }
            .bg-card { background-color: hsl(222.2 84% 4.9%); }
            .bg-muted { background-color: hsl(217.2 32.6% 17.5%); }
            .text-foreground { color: hsl(210 40% 98%); }
            .text-muted-foreground { color: hsl(215 20.2% 65.1%); }
            .text-card-foreground { color: hsl(210 40% 98%); }
            .border-border { border-color: hsl(217.2 32.6% 17.5%); }
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'media',
            theme: {
                extend: {
                    colors: {
                        border: 'hsl(214.3 31.8% 91.4%)',
                        background: 'hsl(0 0% 100%)',
                        foreground: 'hsl(222.2 84% 4.9%)',
                        primary: 'hsl(221.2 83.2% 53.3%)',
                        muted: {
                            DEFAULT: 'hsl(210 40% 96%)',
                            foreground: 'hsl(215.4 16.3% 46.9%)'
                        },
                        card: {
                            DEFAULT: 'hsl(0 0% 100%)',
                            foreground: 'hsl(222.2 84% 4.9%)'
                        },
                        destructive: 'hsl(0 84.2% 60.2%)'
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = Motion;
        // Simple icon components as fallbacks
        const Activity = () => React.createElement('span', { className: 'text-lg' }, 'ðŸ“Š');
        const Wifi = () => React.createElement('span', { className: 'text-lg' }, 'ðŸ“¶');
        const Database = () => React.createElement('span', { className: 'text-lg' }, 'ðŸ—„ï¸');
        const Users = () => React.createElement('span', { className: 'text-lg' }, 'ðŸ‘¥');
        const Clock = () => React.createElement('span', { className: 'text-lg' }, 'â±ï¸');
        const TrendingUp = () => React.createElement('span', { className: 'text-lg' }, 'ðŸ“ˆ');
        const Server = () => React.createElement('span', { className: 'text-lg' }, 'ðŸ–¥ï¸');
        const Network = () => React.createElement('span', { className: 'text-lg' }, 'ðŸŒ');
        const HardDrive = () => React.createElement('span', { className: 'text-lg' }, 'ðŸ’¾');
        const Zap = () => React.createElement('span', { className: 'text-lg' }, 'âš¡');

        function cn(...inputs) {
            return clsx(inputs);
        }

        // Card Components
        function Card({ className, children, ...props }) {
            return React.createElement('div', {
                className: cn(
                    "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border border-border py-6 shadow-sm backdrop-blur-sm bg-opacity-95",
                    className
                ),
                ...props
            }, children);
        }

        function CardHeader({ className, children, ...props }) {
            return React.createElement('div', {
                className: cn(
                    "grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6",
                    className
                ),
                ...props
            }, children);
        }

        function CardTitle({ className, children, ...props }) {
            return React.createElement('div', {
                className: cn("leading-none font-semibold", className),
                ...props
            }, children);
        }

        function CardDescription({ className, children, ...props }) {
            return React.createElement('div', {
                className: cn("text-muted-foreground text-sm", className),
                ...props
            }, children);
        }

        function CardContent({ className, children, ...props }) {
            return React.createElement('div', {
                className: cn("px-6", className),
                ...props
            }, children);
        }

        // Progress Component
        function Progress({ value, className, ...props }) {
            return React.createElement('div', {
                className: cn(
                    "bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",
                    className
                ),
                ...props
            }, 
                React.createElement('div', {
                    className: "bg-primary h-full w-full flex-1 transition-all",
                    style: { transform: `translateX(-${100 - (value || 0)}%)` }
                })
            );
        }

        // Sparkline Component
        function Sparkline({ data, color = "#3b82f6", spikeColor = "#ef4444", width = 80, height = 24 }) {
            const points = data.map((point, index) => ({
                x: (index / (data.length - 1)) * width,
                y: height - (point.value / 100) * height,
                isSpike: point.isSpike,
            }));

            const path = points.reduce((acc, point, index) => {
                if (index === 0) return `M ${point.x} ${point.y}`;
                return `${acc} L ${point.x} ${point.y}`;
            }, "");

            const hasSpikes = points.some((p) => p.isSpike);

            return React.createElement('svg', {
                width: width,
                height: height,
                className: "overflow-visible"
            },
                React.createElement('defs', {},
                    React.createElement('linearGradient', {
                        id: `gradient-${color}`,
                        x1: "0%",
                        y1: "0%",
                        x2: "0%",
                        y2: "100%"
                    },
                        React.createElement('stop', {
                            offset: "0%",
                            stopColor: hasSpikes ? spikeColor : color,
                            stopOpacity: 0.3
                        }),
                        React.createElement('stop', {
                            offset: "100%",
                            stopColor: hasSpikes ? spikeColor : color,
                            stopOpacity: 0.1
                        })
                    )
                ),
                React.createElement('path', {
                    d: `${path} L ${width} ${height} L 0 ${height} Z`,
                    fill: `url(#gradient-${color})`,
                }),
                React.createElement('path', {
                    d: path,
                    fill: "none",
                    stroke: hasSpikes ? spikeColor : color,
                    strokeWidth: 1.5,
                    strokeLinecap: "round",
                    strokeLinejoin: "round"
                }),
                ...points.map((point, index) =>
                    point.isSpike ? React.createElement('circle', {
                        key: index,
                        cx: point.x,
                        cy: point.y,
                        r: 2,
                        fill: spikeColor
                    }) : null
                ).filter(Boolean)
            );
        }

        // Metric Card Component
        function MetricCard({ icon: Icon, title, value, unit, data, color, description }) {
            const hasSpikes = data.some((d) => d.isSpike);

            return React.createElement(Card, {
                className: "h-full hover:border-primary/50 transition-all duration-300"
            },
                React.createElement(CardHeader, {},
                    React.createElement('div', { className: "flex items-center justify-between" },
                        React.createElement('div', { className: "flex items-center gap-3" },
                            React.createElement('div', {
                                className: cn(
                                    "flex items-center justify-center w-10 h-10 rounded-lg",
                                    hasSpikes ? "bg-destructive/10" : "bg-muted"
                                )
                            },
                                React.createElement(Icon, {
                                    className: cn("w-5 h-5", hasSpikes ? "text-destructive" : "text-muted-foreground")
                                })
                            ),
                            React.createElement('div', {},
                                React.createElement(CardTitle, { className: "text-sm" }, title),
                                description && React.createElement(CardDescription, { className: "text-xs" }, description)
                            )
                        )
                    )
                ),
                React.createElement(CardContent, {},
                    React.createElement('div', { className: "space-y-4" },
                        React.createElement('div', { className: "flex items-end justify-between" },
                            React.createElement('div', {
                                className: cn("text-2xl font-bold", hasSpikes ? "text-destructive" : "text-foreground")
                            }, `${value.toLocaleString()} ${unit}`),
                            React.createElement('div', { className: "text-right" },
                                React.createElement(Sparkline, { data, color })
                            )
                        )
                    )
                )
            );
        }

        // Peer Progress Card Component
        function PeerProgressCard({ totalPeers, activePeers, data }) {
            const percentage = totalPeers > 0 ? (activePeers / totalPeers) * 100 : 0;
            const hasSpikes = data.some((d) => d.isSpike);

            return React.createElement(Card, {},
                React.createElement(CardHeader, {},
                    React.createElement('div', { className: "flex items-center gap-3" },
                        React.createElement('div', {
                            className: cn(
                                "flex items-center justify-center w-10 h-10 rounded-lg",
                                hasSpikes ? "bg-destructive/10" : "bg-muted"
                            )
                        },
                            React.createElement(Users, {
                                className: cn("w-5 h-5", hasSpikes ? "text-destructive" : "text-muted-foreground")
                            })
                        ),
                        React.createElement('div', {},
                            React.createElement(CardTitle, { className: "text-sm" }, "Network Peers"),
                            React.createElement(CardDescription, { className: "text-xs" }, "Connected nodes")
                        )
                    )
                ),
                React.createElement(CardContent, {},
                    React.createElement('div', { className: "space-y-4" },
                        React.createElement('div', { className: "flex items-center justify-between" },
                            React.createElement('span', { className: "text-sm text-muted-foreground" }, "Active Peers"),
                            React.createElement('span', { className: "text-lg font-bold text-foreground" }, `${activePeers}/${totalPeers}`)
                        ),
                        React.createElement(Progress, { value: percentage, className: "h-3" }),
                        React.createElement('div', { className: "flex items-center justify-between text-xs" },
                            React.createElement('span', { className: "text-primary font-medium" }, `${percentage.toFixed(1)}%`),
                            React.createElement('span', { className: "text-muted-foreground" }, `${activePeers} active of ${totalPeers} total`)
                        ),
                        React.createElement('div', { className: "mt-2" },
                            React.createElement(Sparkline, { data, color: "#10b981", width: 60, height: 20 })
                        )
                    )
                )
            );
        }

        // Uptime Card Component
        function UptimeCard({ uptime }) {
            const days = Math.floor(uptime / (24 * 60 * 60));
            const hours = Math.floor((uptime % (24 * 60 * 60)) / (60 * 60));
            const minutes = Math.floor((uptime % (60 * 60)) / 60);

            return React.createElement(Card, {},
                React.createElement(CardHeader, {},
                    React.createElement('div', { className: "flex items-center gap-3" },
                        React.createElement('div', { className: "flex items-center justify-center w-10 h-10 rounded-lg bg-muted" },
                            React.createElement(Clock, { className: "w-5 h-5 text-muted-foreground" })
                        ),
                        React.createElement('div', {},
                            React.createElement(CardTitle, { className: "text-sm" }, "System Uptime"),
                            React.createElement(CardDescription, { className: "text-xs" }, "Node operational time")
                        )
                    )
                ),
                React.createElement(CardContent, {},
                    React.createElement('div', { className: "grid grid-cols-3 gap-4 text-center" },
                        React.createElement('div', {},
                            React.createElement('div', { className: "text-2xl font-bold text-foreground" }, days),
                            React.createElement('div', { className: "text-xs text-muted-foreground" }, "Days")
                        ),
                        React.createElement('div', {},
                            React.createElement('div', { className: "text-2xl font-bold text-foreground" }, hours),
                            React.createElement('div', { className: "text-xs text-muted-foreground" }, "Hours")
                        ),
                        React.createElement('div', {},
                            React.createElement('div', { className: "text-2xl font-bold text-foreground" }, minutes),
                            React.createElement('div', { className: "text-xs text-muted-foreground" }, "Minutes")
                        )
                    )
                )
            );
        }

        // Main Dashboard Component
        function AmadeusDashboard() {
            const [metrics, setMetrics] = useState({
                messagesPerSec: 0,
                bytesTransferred: 0,
                totalPeers: 0,
                activePeers: 0,
                blockchainEntries: 0,
                uptime: 0,
                networkLatency: 0,
                cpuUsage: 0,
                memoryUsage: 0,
                handledProtos: {},
                errors: {}
            });

            const [historicalData, setHistoricalData] = useState({
                messages: [],
                bytes: [],
                peers: [],
                entries: [],
                latency: [],
                cpu: [],
                memory: [],
            });

            // Generate data point with spike detection
            const generateDataPoint = (baseValue, variance, spikeChance = 0.05) => {
                const isSpike = Math.random() < spikeChance;
                const multiplier = isSpike ? 1.5 + Math.random() * 0.5 : 1;
                const value = Math.max(0, Math.min(100, baseValue + (Math.random() - 0.5) * variance * multiplier));

                return {
                    value,
                    timestamp: Date.now(),
                    isSpike: isSpike && value > 70,
                };
            };

            // Fetch real data from backend
            const fetchMetrics = async () => {
                try {
                    const [metricsRes, peersRes] = await Promise.all([
                        fetch('/metrics/json'),
                        fetch('/peers/json')
                    ]);

                    const metricsData = await metricsRes.json();
                    const peersData = await peersRes.json();

                    // Calculate derived metrics
                    const totalMessages = Object.values(metricsData.handled_protos || {}).reduce((a, b) => a + b, 0);
                    const messagesPerSec = totalMessages > 0 ? Math.round(totalMessages / (metricsData.uptime || 1)) : 0;
                    const bytesPerSec = metricsData.packets ? Math.round(metricsData.packets.incoming_bytes / (metricsData.uptime || 1)) : 0;

                    const newMetrics = {
                        messagesPerSec,
                        bytesTransferred: metricsData.packets?.incoming_bytes || 0,
                        totalPeers: Object.keys(peersData || {}).length,
                        activePeers: Object.keys(peersData || {}).length, // Assume all peers are active for now
                        blockchainEntries: totalMessages, // Using total messages as proxy
                        uptime: metricsData.uptime || 0,
                        networkLatency: Math.floor(Math.random() * 100) + 20, // Simulated
                        cpuUsage: Math.floor(Math.random() * 60) + 20, // Simulated
                        memoryUsage: Math.floor(Math.random() * 40) + 30, // Simulated
                        handledProtos: metricsData.handled_protos || {},
                        errors: metricsData.errors || {}
                    };

                    setMetrics(newMetrics);

                    // Update historical data
                    setHistoricalData(prev => {
                        const maxPoints = 20;
                        return {
                            messages: [...prev.messages, generateDataPoint(messagesPerSec / 10, 20, 0.1)].slice(-maxPoints),
                            bytes: [...prev.bytes, generateDataPoint(bytesPerSec / 1000, 30, 0.08)].slice(-maxPoints),
                            peers: [...prev.peers, generateDataPoint((newMetrics.activePeers / Math.max(newMetrics.totalPeers, 1)) * 100, 15, 0.05)].slice(-maxPoints),
                            entries: [...prev.entries, generateDataPoint(50, 25, 0.06)].slice(-maxPoints),
                            latency: [...prev.latency, generateDataPoint(newMetrics.networkLatency, 20, 0.12)].slice(-maxPoints),
                            cpu: [...prev.cpu, generateDataPoint(newMetrics.cpuUsage, 25, 0.08)].slice(-maxPoints),
                            memory: [...prev.memory, generateDataPoint(newMetrics.memoryUsage, 20, 0.06)].slice(-maxPoints),
                        };
                    });

                } catch (error) {
                    console.error('Failed to fetch metrics:', error);
                }
            };

            useEffect(() => {
                // Fetch initial data
                fetchMetrics();

                // Set up polling
                const interval = setInterval(fetchMetrics, 2000);
                return () => clearInterval(interval);
            }, []);

            return React.createElement('div', { className: "min-h-screen bg-background p-6" },
                React.createElement('div', { className: "max-w-7xl mx-auto space-y-6" },
                    // Header
                    React.createElement('div', { className: "text-center space-y-2" },
                        React.createElement('h1', { className: "text-4xl font-bold text-foreground" }, "Amadeus Blockchain Node Dashboard"),
                        React.createElement('p', { className: "text-muted-foreground" }, "Real-time monitoring of network statistics and system performance")
                    ),

                    // Network Statistics
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" },
                        React.createElement(MetricCard, {
                            icon: Activity,
                            title: "Messages/Sec",
                            value: metrics.messagesPerSec,
                            unit: "msg/s",
                            data: historicalData.messages,
                            color: "#3b82f6",
                            description: "Protocol messages"
                        }),
                        React.createElement(MetricCard, {
                            icon: TrendingUp,
                            title: "Bytes Transferred",
                            value: Math.floor(metrics.bytesTransferred / 1024),
                            unit: "KB",
                            data: historicalData.bytes,
                            color: "#10b981",
                            description: "Network throughput"
                        }),
                        React.createElement(MetricCard, {
                            icon: Database,
                            title: "Total Messages",
                            value: metrics.blockchainEntries,
                            unit: "",
                            data: historicalData.entries,
                            color: "#f59e0b",
                            description: "Handled protocols"
                        }),
                        React.createElement(MetricCard, {
                            icon: Wifi,
                            title: "Network Latency",
                            value: metrics.networkLatency,
                            unit: "ms",
                            data: historicalData.latency,
                            color: "#8b5cf6",
                            description: "Response time"
                        })
                    ),

                    // Peer Information & System Stats
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" },
                        React.createElement(PeerProgressCard, {
                            totalPeers: metrics.totalPeers,
                            activePeers: metrics.activePeers,
                            data: historicalData.peers
                        }),
                        React.createElement(UptimeCard, { uptime: metrics.uptime }),
                        React.createElement(MetricCard, {
                            icon: Zap,
                            title: "CPU Usage",
                            value: metrics.cpuUsage,
                            unit: "%",
                            data: historicalData.cpu,
                            color: "#ef4444",
                            description: "Processor load"
                        })
                    ),

                    // System Resources & Status
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                        React.createElement(MetricCard, {
                            icon: HardDrive,
                            title: "Memory Usage",
                            value: metrics.memoryUsage,
                            unit: "%",
                            data: historicalData.memory,
                            color: "#06b6d4",
                            description: "RAM utilization"
                        }),
                        React.createElement(Card, {},
                            React.createElement(CardHeader, {},
                                React.createElement('div', { className: "flex items-center gap-3" },
                                    React.createElement('div', { className: "flex items-center justify-center w-10 h-10 rounded-lg bg-muted" },
                                        React.createElement(Server, { className: "w-5 h-5 text-muted-foreground" })
                                    ),
                                    React.createElement('div', {},
                                        React.createElement(CardTitle, { className: "text-sm" }, "Protocol Statistics"),
                                        React.createElement(CardDescription, { className: "text-xs" }, "Message handling overview")
                                    )
                                )
                            ),
                            React.createElement(CardContent, {},
                                React.createElement('div', { className: "space-y-3" },
                                    Object.entries(metrics.handledProtos).slice(0, 5).map(([protocol, count]) =>
                                        React.createElement('div', {
                                            key: protocol,
                                            className: "flex items-center justify-between"
                                        },
                                            React.createElement('span', { className: "text-sm text-muted-foreground" }, protocol),
                                            React.createElement('span', { className: "text-sm font-medium text-foreground" }, count.toLocaleString())
                                        )
                                    ),
                                    Object.keys(metrics.handledProtos).length === 0 && 
                                        React.createElement('div', { className: "text-sm text-muted-foreground text-center py-4" }, "No protocol data yet")
                                )
                            )
                        )
                    ),

                    // Error Statistics if any
                    Object.keys(metrics.errors).length > 0 && React.createElement(Card, {},
                        React.createElement(CardHeader, {},
                            React.createElement('div', { className: "flex items-center gap-3" },
                                React.createElement('div', { className: "flex items-center justify-center w-10 h-10 rounded-lg bg-destructive/10" },
                                    React.createElement(Activity, { className: "w-5 h-5 text-destructive" })
                                ),
                                React.createElement('div', {},
                                    React.createElement(CardTitle, { className: "text-sm" }, "Error Statistics"),
                                    React.createElement(CardDescription, { className: "text-xs" }, "Recent error counts")
                                )
                            )
                        ),
                        React.createElement(CardContent, {},
                            React.createElement('div', { className: "space-y-3" },
                                Object.entries(metrics.errors).map(([errorType, count]) =>
                                    React.createElement('div', {
                                        key: errorType,
                                        className: "flex items-center justify-between"
                                    },
                                        React.createElement('span', { className: "text-sm text-muted-foreground" }, errorType),
                                        React.createElement('span', { className: "text-sm font-medium text-destructive" }, count.toLocaleString())
                                    )
                                )
                            )
                        )
                    )
                )
            );
        }

        // Render the dashboard
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(AmadeusDashboard));
    </script>
</body>
</html>